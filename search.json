[
  {
    "objectID": "website/eval-liasses.html",
    "href": "website/eval-liasses.html",
    "title": "Evaluation d‚Äôun mod√®le",
    "section": "",
    "text": "viewof username = Inputs.password({label: html`&lt;b&gt;Set username&lt;/b&gt;`, value: \"\"})\n\n\n\n\n\n\n\nviewof password = Inputs.password({label: html`&lt;b&gt;Set password&lt;/b&gt;`, value: \"\"})\n\n\n\n\n\n\n\nviewof csvfile = Inputs.file({\n  label: md`__Observations to evaluate__ üìÅ ([Example here](https://raw.githubusercontent.com/ThomasFaria/codif-ape-API/main/website/exemples/exemple.csv))`,\n  accept: \".csv\",\n  required: true\n})"
  },
  {
    "objectID": "website/eval-liasses.html#connexion-√†-lapi-et-ajout-des-donn√©es",
    "href": "website/eval-liasses.html#connexion-√†-lapi-et-ajout-des-donn√©es",
    "title": "Evaluation d‚Äôun mod√®le",
    "section": "",
    "text": "viewof username = Inputs.password({label: html`&lt;b&gt;Set username&lt;/b&gt;`, value: \"\"})\n\n\n\n\n\n\n\nviewof password = Inputs.password({label: html`&lt;b&gt;Set password&lt;/b&gt;`, value: \"\"})\n\n\n\n\n\n\n\nviewof csvfile = Inputs.file({\n  label: md`__Observations to evaluate__ üìÅ ([Example here](https://raw.githubusercontent.com/ThomasFaria/codif-ape-API/main/website/exemples/exemple.csv))`,\n  accept: \".csv\",\n  required: true\n})"
  },
  {
    "objectID": "website/eval-liasses.html#distribution-des-indices-de-confiances",
    "href": "website/eval-liasses.html#distribution-des-indices-de-confiances",
    "title": "Evaluation d‚Äôun mod√®le",
    "section": "Distribution des indices de confiances",
    "text": "Distribution des indices de confiances\n\ngrid = await html`&lt;div style=\"\n              background: #fff;\n              margin: 0;\n              border: none ;\n              display: grid;\n              width: ${screen.width};\n              grid-template-areas:\n                'a b c'\n                'd d d'\n                ;\n              grid-gap: 10px;\n            \"&gt;\n              &lt;div name=\"a\" style=\"grid-area: a; position: relative;\"&gt;${viewof quantile}&lt;/div&gt;\n              &lt;div name=\"b\" style=\"grid-area: b; position: relative;\"&gt;&lt;div class=\"textstyled\"&gt;Accuracy: ${Accuracy}&lt;/div&gt;&lt;/div&gt;\n              &lt;div name=\"c\" style=\"grid-area: c; position: relative;\"&gt;&lt;div class=\"textstyled\"&gt;Seuil: ${Seuil}&lt;/div&gt;&lt;/div&gt;\n              &lt;div name=\"d\" style=\"grid-area: d; position: relative;\"&gt;${distrib}&lt;/div&gt;\n            &lt;/div&gt;`\n\n\n\n\n\n\n\nviewof quantile = Inputs.range([0, 100], {label: \"Taux de classification automatique\", step: 1, value: 80})\n\n\n\n\n\n\n\ndistrib = Plot.plot({\n  round: true,\n  width: screen.width * 0.7,\n  color: { scheme: \"BuRd\", legend: true },\n  marks: [\n    Plot.rectY(\n      processed_response,\n      Plot.binX(\n        { y: \"count\" },\n        { x: \"IC\", fill: \"Result\", mixBlendMode: \"multiply\", tip: true }\n      )\n    ),\n    Plot.ruleY([0]),\n    Plot.ruleX([Seuil], { strokeWidth: 2, tip: true })\n  ]\n})\n\n\n\n\n\n\n\nSeuil = Math.round(\n  d3.quantile(\n    processed_response.map((d) =&gt; d.IC),\n    1 - quantile / 100\n  ) * 100\n) / 100\n\n\n\n\n\n\n\nAccuracy = Math.round(d3.mean(subset.map((d) =&gt; d.IC)) * 10000) / 100\n\n\n\n\n\n\n\nInputs.table(processed_response)"
  },
  {
    "objectID": "website/eval-liasses.html#taux-de-classification-automatique-sur-ic",
    "href": "website/eval-liasses.html#taux-de-classification-automatique-sur-ic",
    "title": "Evaluation d‚Äôun mod√®le",
    "section": "Taux de classification automatique sur IC",
    "text": "Taux de classification automatique sur IC\n\nPlot.plot({\n  grid: true,\n  y: {\n    label: \"‚Üë Indice de confiance\"\n  },\n  x: {\n    label: \"‚Üí Taux de classification automatique\"\n  },\n  marks: [\n    Plot.line(ic_tx_classif, {\n      x: \"quantiles\",\n      y: \"seuils\",\n      stroke: \"black\",\n      strokeWidth: 2\n    }),\n    Plot.tip(\n      ic_tx_classif,\n      Plot.pointer({\n        x: \"quantiles\",\n        y: \"seuils\",\n        title: (d) =&gt; `Accuracy : ${get_accuracies_from_threshold(\n          ic_tx_classif,\n          d.seuils\n        )}\\nIC : ${\n          Math.round(d.seuils * 100) / 100\n        }\\nTaux classification automatique\n${d.quantiles}`\n      })\n    )\n  ],\n  color: { legend: true }\n})"
  },
  {
    "objectID": "website/eval-liasses.html#liste-des-mauvaises-predictions",
    "href": "website/eval-liasses.html#liste-des-mauvaises-predictions",
    "title": "Evaluation d‚Äôun mod√®le",
    "section": "Liste des mauvaises predictions",
    "text": "Liste des mauvaises predictions\n\nWrongPredictions = Inputs.table(subset.filter((d) =&gt; 1 - d.Result))\n\n\n\n\n\n\n\n\ndata = db.query(\n  `\nSELECT text_description, type_, nature, surface, event, code\nFROM liasses\n`\n)\n\n\n\n\n\n\n\ntransformedData = data.reduce((acc, obj) =&gt; {\n  for (const [key, value] of Object.entries(obj)) {\n    if (!acc.hasOwnProperty(key)) {\n      acc[key] = [];\n    }\n    acc[key].push(value);\n  }\n  return acc;\n}, {})\n\n\n\n\n\n\n\ndb = DuckDBClient.of({\n  liasses: await csvfile.csv()\n})\n\n\n\n\n\n\n\nprocessed_response = Object.keys(response.IC).map((key) =&gt; ({\n  IC: response.IC[key] &gt; 1 ? 1 - 1e-16 : response.IC[key],\n  Probability: response.Probability[key],\n  Prediction: response.Prediction[key],\n  Code: response.Code[key],\n  Result: response.Result[key],\n  Lib: response.Lib[key]\n}))\n\n\n\n\n\n\n\nresponse = queryBatchApi(username, password, data)\n\n\n\n\n\n\n\nsubset = processed_response.filter((d) =&gt; d.IC &gt; Seuil)\n\n\n\n\n\n\n\nic_tx_classif = {\n  const newArray = [];\n  for (let i = 0; i &lt; quantiles.length; i++) {\n    newArray.push({ quantiles: quantiles[i], seuils: seuils[i] });\n  }\n  return newArray;\n}\n\n\n\n\n\n\n\nquantiles = Array.from({ length: 101 }, (_, i) =&gt; i/100) // Array with quantile values from 0 to 1\n\n\n\n\n\n\n\nseuils = quantiles.map((quantile) =&gt;\n  d3.quantile(\n    processed_response.map((d) =&gt; d.IC),\n    1 - quantile\n  )\n)\n\n\n\n\n\n\n\n\nasync function queryBatchApi(username, password, data) {\n  const url = \"https://codification-ape.lab.sspcloud.fr/evaluation\";\n\n  // Create the request body\n  const request_body = data.reduce((acc, obj) =&gt; {\n    for (const [key, value] of Object.entries(obj)) {\n      if (!acc.hasOwnProperty(key)) {\n        acc[key] = [];\n      }\n      acc[key].push(value);\n    }\n    return acc;\n  }, {});\n\n  const response = await fetch(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Basic ${btoa(`${username}:${password}`)}`\n    },\n    body: JSON.stringify(request_body)\n  });\n\n  if (response.ok) {\n    return response.json();\n  } else if (response.status === 400) {\n    console.log((await response.json()).detail);\n  } else {\n    console.log(\"Error occurred while querying the API.\");\n    return response;\n  }\n}\n\n\n\n\n\n\n\nfunction get_accuracies_from_threshold(d, threshold) {\n  let acc = d3.mean(\n    processed_response.filter((d) =&gt; d.IC &gt; threshold).map((d) =&gt; d.IC)\n  );\n  acc = acc === undefined ? 1 : Math.round(acc * 100) / 100;\n  return acc;\n}\n\n\n\n\n\n\n\n\nPlot = require(\"https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6.8/dist/plot.umd.min.js\")"
  },
  {
    "objectID": "website/index.html",
    "href": "website/index.html",
    "title": "Analyse du mod√®le de codification de l‚ÄôAPE",
    "section": "",
    "text": "function color_accepted(d) {\n  const backgroundColor = d === \"Accepted\" ? \"#5f9c5f\" : \"#fc4747\";\n  return html`&lt;div style=\"background: ${backgroundColor};text-align:right;padding:2px 5px;\"&gt;${d}&lt;/div&gt;`;\n}"
  },
  {
    "objectID": "website/index.html#licence",
    "href": "website/index.html#licence",
    "title": "Analyse du mod√®le de codification de l‚ÄôAPE",
    "section": "Licence",
    "text": "Licence\nThis work is licensed under the Apache License 2.0.\nSee the code on Github."
  },
  {
    "objectID": "website/lmnp.html",
    "href": "website/lmnp.html",
    "title": "Analyse des loueurs meubl√©s non professionnel",
    "section": "",
    "text": "grid = await html`&lt;div style=\"\n              background: #fff;\n              margin: 10;\n              border: none ;\n              display: grid;\n              width: ${screen.width};\n              grid-template-areas:\n                'a b'\n                'c c'\n                'd d'\n                ;\n              grid-gap: 10px;\n            \"&gt;\n              &lt;div name=\"a\" style=\"grid-area: a; position: relative;\"&gt;${viewof Seuil}&lt;/div&gt;\n              &lt;div name=\"b\" style=\"grid-area: b; position: relative;\"&gt;${viewof selection}&lt;/div&gt;\n              &lt;div name=\"c\" style=\"grid-area: c; position: relative;\"&gt;${viewof var_annexes}&lt;/div&gt;\n              &lt;div name=\"d\" style=\"grid-area: d; position: relative;\"&gt;${viewof table_data}&lt;/div&gt;\n            &lt;/div&gt;`\n\n\n\n\n\n\n\nviewof Seuil = Inputs.range([0, 1], {label: \"Seuil choisi\", step: 0.01, value: 0.8})\n\n\n\n\n\n\n\nviewof selection = Inputs.select([\"Tous\", \"Bonnes pr√©dictions\", \"Erreurs reprises\", \"Erreurs probl√©matiques\"], {label: \"R√©sultats des LMNP\"})\n\n\n\n\n\n\n\nviewof var_annexes = Inputs.toggle({label: \"Variables annexes\", values: [true, false]})\n\n\n\n\n\n\n\nviewof table_data = Inputs.table(selector(transpose(data_lmnp), selection), {\n    rows: 17,\n    columns: var_annexes\n  ? [\"text_description\", \"type_\", \"Pr√©diction\", \"Score\", \"nature\", \"surface\", \"event\"]\n  : [\"text_description\", \"type_\", \"Pr√©diction\", \"Score\"],\n  header: {\n    text_description: \"Libell√©\",\n    type_: \"Type\",\n    nature: \"Nature\",\n    surface: \"Surface\",\n    event : \"√âv√®nement\"\n  }, \n  format: {\n    \"Score\": d =&gt; get_background(d)\n  }\n})\n\n\n\n\n\n\n\nfunction get_background(d) {\n    const color = d &gt; Seuil ? \"#19975d\" : \"#f15060\"\n\n  \n  return html`&lt;div style=\"\n    background: ${color.toLocaleString(\"en\")};\n    width: 95%;\n    float: center;\n    border-radius:15px;\n    padding-left: 10px;\n    padding-right: 10px;\n    margin: 0 auto; /* Center the div horizontally */\n    text-align: center; /* Center the text within the div */\n    \"&gt;\n    ${Math.round(d * 10000) / 10000}`;\n}\n\n\n\n\n\n\n\n\nfunction selector(data, selector) {\n    let b;\n    switch (selector) {\n        case \"Tous\":\n            b = data;\n        case \"Bonnes pr√©dictions\":\n            b = data.filter(d =&gt; d.Error === false);\n            break;\n        case \"Erreurs reprises\":\n            b = data.filter(d =&gt; d.Error === true && d.Score &lt;= Seuil);\n            break;\n        case \"Erreurs probl√©matiques\":\n            b = data.filter(d =&gt; d.Error === true && d.Score &gt; Seuil);\n            break;\n        default:\n            break;\n    }\n    return b;\n}\n\n\n\n\n\n\n\nimport {slider} from \"@jashkenas/inputs\""
  }
]